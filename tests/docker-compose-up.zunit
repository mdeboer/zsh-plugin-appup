#!/usr/bin/env zunit

@setup {
    load ../appup.plugin.zsh

    _tmp_setup
}

@teardown {
    _tmp_teardown
}

@test 'Docker compose up' {
    local test_files=('compose.yaml' 'compose.yml' 'docker-compose.yaml' 'docker-compose.yml')

    for f in $test_files; do
        _tmp_setup
        touch "$f"

        run up

        assert $state equals 0
        assert "$output" same_as 'docker compose up'
    done
}

@test 'Docker compose up (with env files and arguments)' {
    touch compose.yaml

    zstyle ':omz:plugins:appup:docker' env-files .env .env.foo .env.local

    touch .env
    touch .env.local

    run up mysql -v

    assert $state equals 0
    assert "$output" same_as 'docker compose --env-file=.env --env-file=.env.local up mysql -v'
}
