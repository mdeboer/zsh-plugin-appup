#!/usr/bin/env zunit

@setup {
    load ../appup.plugin.zsh
    
    _tmp_setup
}

@teardown {
    _tmp_teardown
}

@test 'Docker compose down' {
    local test_files=('compose.yaml' 'compose.yml' 'docker-compose.yaml' 'docker-compose.yml')

    for f in $test_files; do
        _tmp_setup
        touch "$f"

        run down

        assert $state equals 0
        assert "$output" same_as 'docker compose down'
    done
}

@test 'Docker compose down (with env files and arguments)' {
    touch compose.yaml

    zstyle ':omz:plugins:appup:docker' env-files .env .env.foo .env.local

    touch .env
    touch .env.local

    run down mysql -v

    assert $state equals 0
    assert "$output" same_as 'docker compose down mysql -v'
}
